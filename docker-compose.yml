version: "2"
services:
    web:
        build: .
        ports:
            - 80:80
        links:
            - postgres
            - redis
            - rabbitmq
        volumes:
            - ./:/var/www/
            - ./html/.user.ini:/usr/local/etc/php/php.ini
            - ./logs/output.log:/output.log
        environment:
            REDISCLOUD_URL: tcp://redis:6379
            DATABASE_URL: postgres://postgres:password@postgres/shopify
            ENV: dev
            RABBITMQ_BIGWIG_RX_URL: amqp://guest:guest@rabbitmq:5672/shopify
            RABBITMQ_BIGWIG_TX_URL: amqp://guest:guest@rabbitmq:5672/shopify
            RABBITMQ_BIGWIG_URL: amqp://guest:guest@rabbitmq:5672/shopify
    redis:
        image: redis
        # volumes:
            # - ./data/redis:/data # While on free plan, redis does not persist
        ports:
            - 6379:6379
    postgres:
        image: postgres
        volumes:
            - ./data/postgres:/var/lib/postgres
        ports:
            - 5432:5432
        environment:
            POSTGRES_PASSWORD: password
            POSTGRES_USER: postgres
            POSTGRES_DB: shopify
    rabbitmq:
        image: rabbitmq:3
        ports:
            - 5672:5672
            - 15672:15672
